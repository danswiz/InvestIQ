# Memory Log - 2026-02-11

## Revenue Growth Algorithm Evolution

### v4.2.1 - Proportional Sales Growth
- Changed from binary (12 pts if >10%) to proportional
- Formula: `min(max(0, growth/0.3*12), 30)`
- Allows 0-30 points based on revenue growth percentage

### v4.2.2 - 2-Year Consistency Check
- Added prior year revenue growth from DB
- Average current + prior year
- +3 bonus if both years >10%
- New table: `revenue_history` with YoY growth

### v4.2.3 - Strict Gate (<10% = 0 points)
- Both current AND prior year must be >= 10%
- Otherwise: 0 sales growth points
- Filters out companies with inconsistent growth

### v4.2.4 - Fixed Prior Year Fetch Bug
- Query was fetching most recent year instead of prior year
- Fixed to get 2 most recent rows, use 2nd as prior
- OKE properly disqualified (2023: -21%)

### v4.3 - TTM-Based Revenue (Current)
- Uses quarterly data instead of fiscal years
- TTM Current = sum of last 4 quarters
- TTM Prior = sum of quarters 5-8 (12mo ago)
- More accurate rolling 12-month comparison
- New table: `quarterly_revenue`

**Current Formula:**
```python
if ttm_current < 10% or ttm_prior < 10%:
    points = 0
else:
    avg = (ttm_current + ttm_prior) / 2
    points = min(max(0, avg/0.3*12), 27) + 3
```

## Key Lessons
- User wants **incremental changes**, not big bangs
- Must **verify algorithm** before claiming it works
- **Strict filtering** preferred (quality over quantity)
- TTM > Fiscal year for accuracy

## Files Modified Today
- rater.py - Multiple updates to sales growth calc
- update_web_scan.py - Sync with rater changes
- refresh_cache.py - Added quarterly revenue fetch
- ttm_calculator.py - New helper for TTM calc
- templates/index.html - Sortable columns, numeric scores
